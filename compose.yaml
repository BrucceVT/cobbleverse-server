services:
  mc:
    build: .
    container_name: cobbleverse
    restart: unless-stopped
    stdin_open: true
    tty: true

    ports:
      - "${SERVER_PORT:-25565}:25565"
      - "${RCON_PORT:-25575}:25575"

    environment:
      # ── Modpack ─────────────────────────────────
      MODRINTH_MODPACK: ${MODPACK_URL}

      # ── Exclude client-only mods (no server) ───
      MODRINTH_EXCLUDE_FILES: |
        sodium
        sodium-extra
        reeses-sodium-options
        sodium-options-api
        iris
        notenoughanimations
        better-third-person
        immediatelyfast
        entityculling
        moreculling
        continuity
        betterf3
        modmenu
        zoomify
        mouse-tweaks
        sound-physics-remastered
        particle-rain
        music-notification
        infinite-music
        controlling
        better-beds
        entitytexturefeatures
        entity-model-features
        euphoriapatcher
        custom-splash-screen
        better-f1-reborn
        particular
        tooltipfix
        advancement-plaques
        highlight
        low-fire
        soundsbegone
        fancymenu
        konkrete
        brb
        interactic
        cobblemon-catch-rate-display
        complementary-unbound
        iceberg
        MobsBeGone

      # ── Disable mods/datapacks from modpack ─────
      MODRINTH_OVERRIDES_EXCLUSIONS: |
        mods/MobsBeGone-*.jar
        mods/soundsbegone-*.jar
        **/COBBLEVERSE - No Hunger.zip

      # ── Resources ───────────────────────────────
      MEMORY: ${MEMORY:-4G}

      # ── Server settings ─────────────────────────
      DIFFICULTY: ${DIFFICULTY:-normal}
      MODE: ${MODE:-survival}
      MAX_PLAYERS: ${MAX_PLAYERS:-20}
      MOTD: ${MOTD:-§6Cobbleverse §7— §aCatch them all!}
      VIEW_DISTANCE: ${VIEW_DISTANCE:-10}
      SIMULATION_DISTANCE: ${SIMULATION_DISTANCE:-8}
      SEED: ${SEED:-}
      LEVEL: ${LEVEL:-world}
      ONLINE_MODE: ${ONLINE_MODE:-true}

      # ── RCON ────────────────────────────────────
      ENABLE_RCON: ${ENABLE_RCON:-true}
      RCON_PASSWORD: ${RCON_PASSWORD:-changeme-rcon-password}

      # ── Whitelist & OPs ─────────────────────────
      WHITELIST: ${WHITELIST:-}
      OPS: ${OPS:-}

      # ── Timezone ────────────────────────────────
      TZ: ${TZ:-UTC}

    volumes:
      - cobbleverse_data:/data
      - ./extras:/extras:ro
      - ./scripts:/scripts:ro
      # itzg auto-copies /config → /data/config/
      - ./extras/config:/config:ro
      # itzg automatically executes all scripts in init.d on startup
      - ./init.d:/itzg/init.d:ro

volumes:
  cobbleverse_data:
