services:
  mc:
    image: itzg/minecraft-server:${MC_IMAGE_TAG:-java21}
    container_name: cobbleverse
    restart: unless-stopped
    stdin_open: true
    tty: true

    ports:
      - "${SERVER_PORT:-25565}:25565"
      - "${RCON_PORT:-25575}:25575"

    environment:
      # ── EULA & Modpack ────────────────────────
      EULA: "TRUE"
      TYPE: MODRINTH
      MODRINTH_MODPACK: ${MODPACK_URL}
      VERSION: LATEST

      # ── Extra mods (direct URLs) ──────────────
      # Reads /extras/mods-urls.txt — one URL per line.
      MODS_FILE: /extras/mods-urls.txt

      # ── Resources ─────────────────────────────
      MEMORY: ${MEMORY:-16G}
      USE_AIKAR_FLAGS: "true"

      # ── Server settings ───────────────────────
      DIFFICULTY: ${DIFFICULTY:-normal}
      MODE: ${MODE:-survival}
      MAX_PLAYERS: ${MAX_PLAYERS:-20}
      MOTD: ${MOTD:-§6Cobbleverse §7— §aCatch them all!}
      VIEW_DISTANCE: ${VIEW_DISTANCE:-10}
      SIMULATION_DISTANCE: ${SIMULATION_DISTANCE:-8}
      SEED: ${SEED:-}
      LEVEL: ${LEVEL:-world}
      ONLINE_MODE: ${ONLINE_MODE:-true}

      # ── RCON ──────────────────────────────────
      ENABLE_RCON: ${ENABLE_RCON:-true}
      RCON_PASSWORD: ${RCON_PASSWORD:-changeme-rcon-password}

      # ── Whitelist & OPs ───────────────────────
      WHITELIST: ${WHITELIST:-}
      OPS: ${OPS:-}

      # ── Timezone ──────────────────────────────
      TZ: ${TZ:-UTC}

    volumes:
      - ./data:/data
      - ./extras:/extras:ro

    healthcheck:
      test: mc-health
      start_period: 5m
      interval: 30s
      retries: 6
      timeout: 10s
